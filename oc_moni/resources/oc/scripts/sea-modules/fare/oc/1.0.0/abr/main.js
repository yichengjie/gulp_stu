define("fare/oc/1.0.0/abr/main",["tuiValidator","tuiDialog","./services/services","./controllers/controllers","./util/FormDataUtil","./util/FormValid","underscore","./directives/directives","./tpls/table.html","./tpls/publishObject.html"],function(a,b,c){function d(){$("#abrDataSourceCfgForm").tuiValidator({ignore:"",submitId:"abrDataSourceCfgSaveBtn",isDialog:!1,isLabel:!0,isTip:!1,isLabelDown:!0,isErrorDown:!1,dialogMethod:function(a){$.showTuiMessageAlert(a,null,370,120)},dialogTip:"label",submitHandler:function(){var a=angular.element($("#EditControllerDiv")),b=a.scope();b.saveFormData()}})}a("tuiValidator"),a("tuiDialog"),a("./services/services"),a("./controllers/controllers"),a("./directives/directives"),angular.module("app",["app.service","app.controller","app.directive"]),c.exports={init:function(){angular.element(document).ready(function(){angular.bootstrap(document,["app"]),d()})}}}),define("fare/oc/1.0.0/abr/services/services",[],function(){var a=angular.module("app.service",[]);a.factory("FormData",[function(){return{id:"",action:"",carrCode:"",contextPath:"",status:"1",sequcenceNumber:"",serviceType:"*",subCode:"",internationalTag:"",effDate:"",discDate:"",dataSource:"",publishObjectList:[]}}]),a.factory("ErrorData",[function(){return{internationalTag:{tip:"必填",flag:!1},dataSource:{tip:"必填",flag:!1},effDate:{tip:"",flag:!1},discDate:{tip:"",flag:!1},sequcenceNumber:{tip:"",flag:!1},subCode:{tip:"",flag:!1}}}])}),define("fare/oc/1.0.0/abr/controllers/controllers",["fare/oc/1.0.0/abr/util/FormDataUtil","fare/oc/1.0.0/abr/util/FormValid","underscore"],function(a){var b=angular.module("app.controller",[]),c=a("fare/oc/1.0.0/abr/util/FormDataUtil");b.controller("EditController",["$scope","FormData","$http","ErrorData","$q",function(a,b,d,e,f){function g(){i(a.data,a.tbFlagData)}function h(){var b=a.data.id,e=a.data.contextPath+"/abr/findAbrDataSourceCfgById?id="+b;d.get(e).success(function(b){"true"==b.flag?(c.convertVo2FormData(b.vo,a.data),i(a.data,a.tbFlagData)):$.showTuiErrorDialog("获取数据出错！")})}function i(a,b){j(a.publishObjectList,b.publishObject)}function j(a,b){a&&a.length>0&&(b.flag=!0,b.title="收起表格")}a.error=e,a.headerTipStr="新建数据源配置",a.data=b;var k=$.trim($("#id").val()),l=$.trim($("#action").val()),m=$.trim($("#carrCode").val()),n=$.trim($("#contextPath").val());b.id=k,b.action=l,b.carrCode=m,b.contextPath=n,a.tbFlagData={publishObject:{flag:!1,title:"填写表格"}},"add"==l?(a.headerTipStr="新建数据源配置",g()):"update"==l&&(a.headerTipStr="更新数据源配置",h()),a.backPage=function(){window.location.href=a.data.contextPath+"/abr/toCfgAbrDatasource"},a.selectList={serviceTypeList:[{name:"选择",value:"*"},{name:"免费行李",value:"A"},{name:"随携行李",value:"B"},{name:"付费行李",value:"C"},{name:"预付费行李",value:"P"},{name:"禁运行李",value:"E"}]},a.tbTitleList={pbObj:[{title:"发布对象类型"},{title:"部门代码"}]},a.saveFormData=function(){var b=a.data.action,e=a.data.contextPath+"/abr/saveFormData",g=c.convertFormData2Vo(a.data),h=!1;a.$apply(function(){h=c.validFormData(g,a.error,g.status)});var i=c.validSequcenceNumber(g.sequcenceNumber,a.error,d,a.data.contextPath,g.id,f);i.then(function(){h&&$.showTuiConfirmDialog("保存?",function(){d.post(e,g,{params:{action:b}}).success(function(b){"true"==b.flag?$.showTuiSuccessDialog("保存成功！",function(){$.showTuiWaitingDialog("即将返回查询界面!",200,60),setTimeout(function(){$.closeTuiWindow()},5e3),window.location.href=a.data.contextPath+"/abr/toCfgAbrDatasource"}):$.showTuiErrorDialog("保存数据出错！")})})},function(a){console.info("error : "+a)})},a.validEffDate=function(){var b=a.data.effDate;c.validEffDate(b,a.error,a.data.status)},a.validDiscDate=function(){var b=a.data.effDate,d=a.data.discDate;c.validDiscDate(b,d,a.error)},a.validSequcenceNumber=function(){var b=a.data.sequcenceNumber;c.validSequcenceNumber(b,a.error,d,a.data.contextPath,a.data.id,f)},a.validInternationalTag=function(){var b=a.data.internationalTag;c.validInternationalTag(b,a.error)},a.validDataSource=function(){var b=a.data.dataSource;c.validDataSource(b,a.error)}}])}),define("fare/oc/1.0.0/abr/util/FormDataUtil",["fare/oc/1.0.0/abr/util/FormValid","underscore"],function(a){var b=a("fare/oc/1.0.0/abr/util/FormValid"),c={},d=a("underscore");return c.convertFormData2Vo=function(a){var b={};angular.extend(b,a),delete b.action,delete b.contextPath;for(var c=0;c<b.publishObjectList.length;c++)delete b.publishObjectList[c].selected;return b},c.convertVo2FormData=function(a,b){for(var c in b){var d=a.hasOwnProperty(c);d&&(b[c]=a[c])}},c.validFormData=function(a,b,d){var e=!0;return c.validInternationalTag(a.internationalTag,b)||(e=!1),c.validDataSource(a.dataSource,b)||(e=!1),""==a.dataSource&&(b.dataSource.flag=!0,e=!1),c.validEffDate(a.effDate,b,d)||(e=!1),""==a.discDate?a.discDate="9999-12-31":c.validDiscDate(a.effDate,a.discDate,b)||(e=!1),c.validPublisObjectList(a.publishObjectList)||(e=!1),e},c.validPublisObjectList=function(a){var b=!0,c=[];if(null!=a&&a.length>0)for(var e=0;e<a.length;e++){var f=a[e].type+$.trim(a[e].code);c.push(f)}var g=d.uniq(c);return c.length>g.length&&($.showTuiMessageDialog("请填写不同的部门代码！"),b=!1),b},c.validDataSource=function(a,c){var d=!1;return b.strNotNull(a)?(c.dataSource.flag=!1,d=!0):(c.dataSource.flag=!0,d=!1),d},c.validInternationalTag=function(a,c){var d=!1;return b.strNotNull(a)?(d=!0,c.internationalTag.flag=!1):(c.internationalTag.flag=!0,d=!1),d},c.validSequcenceNumber=function(a,c,d,e,f,g){var h=g.defer(),i=h.promise;if(b.strNotNull(a)){var j=e+"/abr/checkSequcenceNumberNotExixt";d.post(j,{id:f,sequcenceNumber:a}).success(function(a){"true"==a.flag?"true"==a.existFlag?(c.sequcenceNumber.flag=!0,c.sequcenceNumber.tip="序列号已存在!",h.reject("序列号已存在!")):(c.sequcenceNumber.flag=!1,c.sequcenceNumber.tip="",h.resolve("序列号不存在，可添加!")):(c.sequcenceNumber.flag=!0,c.sequcenceNumber.tip="检查序列号重复出错!",h.reject("检查序列号重复出错!"))})}else c.sequcenceNumber.flag=!1,c.sequcenceNumber.tip="",h.resolve("序列号为空,可添加!");return i},c.validEffDate=function(a,b,d){var e=!1;if("2"==d)e=!0,b.effDate.flag=!1,b.effDate.tip="";else{var f=new Date;f=new Date(f.getFullYear(),f.getMonth(),f.getDate());var g=c.getDate(a);f>g?(e=!1,b.effDate.tip="生效日期必须大于当前日期。",b.effDate.flag=!0):(e=!0,b.effDate.flag=!1,b.effDate.tip="")}return e},c.validDiscDate=function(a,d,e){var f=!1;if(f=b.strNotNull(d)){var g=c.getDate(a),h=c.getDate(d);g>h?(f=!1,e.discDate.flag=!0,e.discDate.tip="截止日期必须大于等于生效日期。"):(f=!0,e.discDate.flag=!1,e.discDate.tip="")}else f=!0,e.discDate.flag=!1;return f},c.getDate=function(a){var b=a.split("-"),c=b[0],d=b[1],e=b[2];return new Date(c,d-1,e)},c}),define("fare/oc/1.0.0/abr/util/FormValid",[],function(){var a={};a.strNotNull=function(b){var c=!1;return b=a.dealStr(b),b.length>0&&(c=!0),c},a.strIsAlphanumeric=function(a){return/^[A-Za-z0-9]{0,}$/.test(a)},a.strIsShortDate=function(c){var d=!1;return d=a.strNotNull(c),d&&(d=b(c)),d},a.strIsDigital=function(a){return/^[0-9]{0,}$/.test(a)},a.dealStr=function(a){return null==a?"":$.trim(a)};var b=function(a,b){var c=a;if(!/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/.test(c))return!1;var d=!0,e=(new Date).getFullYear()-0,f=c.split(/-/),g=f[0]-0,h=f[1]-0,i=f[2]-0,j=[0,31,29,31,30,31,30,31,31,30,31,30,31],k=function(){return 0==g%400||0==g%4&&0!=g%100};return!b&&(e-20>g||g>e+20)&&(d=!1),(h>12||1>h)&&(d=!1),(j[h]<i||1>i||i>31)&&(d=!1),2==h&&!k()&&i>28&&(d=!1),d};return a}),define("fare/oc/1.0.0/abr/directives/directives",["underscore"],function(a){var b=a("underscore"),c=a("fare/oc/1.0.0/abr/tpls/table.html"),d=a("fare/oc/1.0.0/abr/tpls/publishObject.html"),e=angular.module("app.directive",[]);e.directive("tableInfo",function(){return{restrict:"E",replace:!0,scope:{tableWidth:"@",hiddenInputId:"@",rowHtml:"@",action:"=",titleList:"=",list:"=",status:"="},template:function(a,e){var f=e.rowHtml,g="",h=b.template(c);return"publishObject.html"==f&&(g=h({value:d})),g},controller:["$scope","$element","$attrs",function(a){function b(){angular.forEach(a.list,function(a){a.selected=!1})}var c=a.rowHtml;a.tbAddLine=function(){"3"!=a.status&&(b(),"publishObject.html"==c&&a.list.push({type:"V",code:"",selected:!0}))},a.tbDelLine=function(){var c=a.list.length;if(c>=1){var d=c-1;angular.forEach(a.list,function(a,b){a.selected&&(d=b)}),a.$apply(function(){b(),a.list.splice(d,1)}),$("#"+a.hiddenInputId).trigger("click")}},a.clickTr=function(a){b(),a.selected=!0},a.selectList={publishObjectList:[{name:"V",value:"V"}]}}],transclude:!0,link:function(a,b){b.find("div.delete_line").bind("click",function(){a.tbDelLine()})}}}),e.directive("ocError",function(){return{restrict:"AE",replace:!0,scope:{error:"="},template:function(a,b){var c=b.name,d='<label ng-show ="error.'+c+'.flag" class="tui_input_error" style="position: absolute; z-index: 10; width: auto; height: auto;" for="'+c+'" generated="true">'+'<span class="icon_error" style="margin:-1px 6px 0 0;"></span><span ng-bind="error.'+c+'.tip"></span>'+"</label>";return d}}}),e.directive("setFocus",function(){return{restrict:"AE",replace:!0,scope:!0,link:function(a,b){b.trigger("click")}}}),e.directive("upperInput",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){function e(){var a=d.$viewValue||"";a=a.toUpperCase(),d.$setViewValue(a),b.val(a)}d&&(d.$render=function(){var a=d.$viewValue||"";a=a.toUpperCase(),b.val(a),d.$setViewValue(a)},b.bind("blur",function(){a.$apply(e)}))}}}),e.directive("showHideTable",function(){return{restrict:"E",replace:!0,scope:{tbInfo:"="},controller:["$scope","$element","$attrs",function(a){var b="填写表格",c="收起表格";a.showHideTable=function(){a.tbInfo.flag=!a.tbInfo.flag,a.tbInfo.title=a.tbInfo.flag?c:b}}],template:'<div><a href = "javascript:void(0)" ng-click = "showHideTable();" ng-bind = "tbInfo.title"></a><div ng-show = "tbInfo.flag" ng-transclude=""></div></div>',transclude:!0}}),e.directive("datepicker",function(){return{restrict:"A",scope:{},link:function(a,b){var c=new Date;$(b).datepicker({minDate:c,showButtonPanel:!0})}}}),e.directive("canChage",function(){return{restrict:"A",replace:!0,scope:!0,link:function(a,b,c){var d=c.canChage,e=!1,f=a.data.status;"1"==f?e=!0:"2"==f&&("effDate"==d||"sequcenceNumber"==d)&&(e=!0),e||c.$set("disabled","disabled")}}})}),define("fare/oc/1.0.0/abr/tpls/table.html",[],'<div class = "table_layout" style="width: {{tableWidth}}px;">\n	<table>\n	<thead>\n		<tr ng-if = "list.length>0">\n			 <th ng-repeat="tl in titleList" ng-bind="tl.title"></th>\n		</tr>\n		<tr ng-if = "list.length==0">\n			 <th>无记录</th>\n		</tr>\n	</thead>\n	<tbody>\n		<tr class = "hidden">\n			<!-- 这一个inpuy非常重要不能删除 -->\n			<td><input  id = "{{hiddenInputId}}"   type = "text" /></td>\n		</tr>\n		<%=value%>\n	</tbody>\n	</table>\n	<div class="helper_margin_top_10px" ng-show="action==\'add\'">\n		<div class="btn_page btn_add_small">\n	    	<div class="btn_left"></div>\n	        <div class="btn_content" ng-click = "tbAddLine();" >增加一行</div>\n	        <div class="btn_right"></div>\n	    </div>\n		<div class="btn_page btn_add_small_2">\n	    	<div class="btn_left"></div>\n			<div class="btn_content delete_line">删除一行</div>\n	        <div class="btn_right"></div>\n	    </div>\n		<div class="clearfix"></div>\n	</div>\n</div>'),define("fare/oc/1.0.0/abr/tpls/publishObject.html",[],'<tr ng-repeat = "l in list" ng-click = "clickTr(l);" ng-class = "{true:\'selectTd\',false:\'\'}[l.selected]">\n    <td><div class="input_outer">\n		<select ng-model="l.type" \n			style="width:100px;"\n			ng-disabled = "status!=\'1\'"\n			ng-options="c.value as c.name for c in selectList.publishObjectList">\n		</select></div>\n	</td>\n    <td><div class="input_outer"><input type = "text" upper-input="" set-focus="" ng-disabled = "status!=\'1\'" ng-model = "l.code" maxLength ="10" class = "input_normal tuiRequired tuiAlphanumericOrStart"  placeholder = "输入*表示不做限制"></div></td>\n</tr> ');
