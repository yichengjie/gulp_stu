define("fare/oc/1.0.0/s7queryMain",["./s7query","jquery","tuiValidator","datepicker","tuiDialog","./common","./equipment","./util","underscore","./s7publish","./s7delete"],function(a){var b=a("./s7query");new b;var c=a("./s7publish"),d=new c;d.init();var e=a("./s7delete"),f=new e;f.init()}),define("fare/oc/1.0.0/s7query",["jquery","tuiValidator","datepicker","tuiDialog","fare/oc/1.0.0/common","fare/oc/1.0.0/equipment","fare/oc/1.0.0/util","underscore"],function(a,b,c){function d(){this._init()}var e=a("jquery");a("tuiValidator"),a("datepicker"),a("tuiDialog");var f=a("fare/oc/1.0.0/common"),g=new f,h=a("fare/oc/1.0.0/equipment"),i=new h,j=a("fare/oc/1.0.0/util"),k=a("underscore");c.exports=d,d.prototype._init=function(){var a=this;e("#effectMaxDate").datepicker({showButtonPanel:!0,clearBtn:!0,yearSuffix:"",changeMonth:!0,changeYear:!0}),e("#effectMinDate").datepicker({showButtonPanel:!0,clearBtn:!0,yearSuffix:"",changeMonth:!0,changeYear:!0}),e(document).ready(function(){e("[mode=upper]").each(function(){e(this).bind("keyup",function(){e(this).val(e(this).val().toUpperCase())})}),i.query("F"),e("#s7QueryBtn").click(function(){a.query()})}),e(document).delegate(":checkbox[name=s5check]","change",function(){e(this).is(":checked")?e(this).parents(".data_section").find("table").find(":checkbox[name=s7check]").attr("checked","checked"):e(this).parents(".data_section").find("table").find(":checkbox[name=s7check]").removeAttr("checked")})},d.prototype.query=function(){var a=e("#s7QueryBtn").attr("url"),b=this,c=this.getData();g.baseOptions.url=a,g.baseOptions.dataType="json",g.baseOptions.data=c,g.baseOptions.success=function(a){return null===a?(window.location.reload(),void 0):0===a.length?(e("#s7content").empty(),e.showTuiMessageDialog("没有相应搜索条件下的结果！"),void 0):(b._resultData(a),void 0)},e.ajax(g.baseOptions)},d.prototype.getData=function(){var a={};a.status=this.getStatusData("status"),a.effStatus=this.getStatusData("effStatus");var b=e("#server").val();return"商务名称"===b?a.commercialName=e("#service").val():a.subCode=e("#service").val(),a.effectMaxDate=e("#effectMaxDate").val(),a.effectMinDate=e("#effectMinDate").val(),a.equipment=this._getEquipment(),a.cabin=this.getCabinData("cabin"),console.log(a.cabin),a.geoSpecLoc1Type=e("#geoSpecLoc1Type").attr("checked")?e("#geoSpecLoc1Type").val():"",a.geoSpecLoc1=e("#geoSpecLoc1").val(),a.geoSpecLoc2Type=e("#geoSpecLoc2Type").attr("checked")?e("#geoSpecLoc2Type").val():"",a.geoSpecLoc2=e("#geoSpecLoc2").val(),a.geoSpecLoc3Type=e("#geoSpecLoc3Type").attr("checked")?e("#geoSpecLoc3Type").val():"",a.geoSpecLoc3=e("#geoSpecLoc3").val(),a.carrCode=e("#carrCode").val(),a},d.prototype._getEquipment=function(){var a=e("#s7_F_equipment").val();return""!==a&&null!==a&&"undefined"!=typeof a?a.split("-")[0]:""},d.prototype.getStatusData=function(a){for(var b="",c="",d=document.getElementsByName(a),e=0;e<d.length;e++)b+=d[e].checked===!0?"1":"0";for(var f=0;f<d.length;f++)c+="0";return b===c&&(b=""),b},d.prototype.getCabinData=function(a){for(var b="",c=document.getElementsByName(a),d=0;d<c.length;d++)c[d].checked===!0&&(b+=c[d].value);return b},d.prototype._resultData=function(a){var b=e("#tag_ctx").val();e("#s7content").empty();var c=e("#s7content"),d=this;c.html("");for(var f=0;f<a.length;f++){var g=a[f],h=g.s7VoList,i=e('<div name="contentContainer" class="data_section markDiv"></div>'),j=e('<div class="helper_float_left route_layout"></div>'),k=e('<div class="helper_float_right ocprice"></div>'),l=e('<div class="typelist"><span>'+g.basicInfoVo.serviceGroupDescription+"</span>&nbsp;&gt;&nbsp;<span>"+g.basicInfoVo.subGroupDescription+"</span>&nbsp;&gt;&nbsp;</div>"+'<div class="commo_name"><label for="chooseAll"><input name="s5check" type="checkbox"/><span class="gray">[</span>&nbsp;<span class="txt_subcode bold">'+g.serviceSubCode+'</span>&nbsp;<span class="gray">]</span>'+'&nbsp;<span class="bold">'+g.commercialName+"</span>"+"</label></div>");l.appendTo(j);for(var m=e('<table cellspacing="0" cellpadding="0" border="0"></table>'),n=e("<tbody></tbody>"),o=0;o<h.length;o++){var p=h[o],q=" ",r=p.frequentFlyerStatus;null!==r&&(q=r);var s=p.id,t=p.sequenceNumber,u=""===p.noChargeNotAvailable?d._getMoney(p):d._getFeeAvailability(p.noChargeNotAvailable),v='<tr class="border_bottom">',w='<td><input name="s7check" type="checkbox"></input><input name="s7id" value="'+s+'"type="hidden"></input></td> ',x='<td><div class="imginfo"><img alt="" src="'+b+"/resources/oc/images/products/"+d._getPicture(p.serviceAndSubCode)+'"/></div></td>',y='<td><p class="desinfo" id="ocPriceDescription">'+_formatDescription(p.description)+"</p></td>",z='<td><span name="sequenceNumber">'+t+"</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td> ",A='<td><div class="price_time"><span name="firstMaintenanceDate">'+p.firstMaintenanceDate+'</span>&nbsp;&mdash;&nbsp;<span name="lastMaintenanceDate">'+p.lastMaintenanceDate+"</span><br>"+'<span class="odcity">'+p.geoSpecLoc1+_showGeoSpecLocType(p.geoSpecLoc1Type)+'</span>&nbsp;-&nbsp;<span class="odcity">'+p.geoSpecLoc2+_showGeoSpecLocType(p.geoSpecLoc2Type)+"</span>"+'<span class="helper_float_right '+d._getColor(p)+'">'+d._generateStatus(p)+'</span><div class="clearfix"></div></div></td>',B='<td><div class="city_passenger"><div>'+d._getPassengerTypeCode(p)+'</div><div class="bold">'+q+"</div></div></td>",C='<td><div class="release_status"><span class="pricetag">'+u+"</span></div></td>",D='<td><div class="helper_float_right operate_btn"><a href="#" title="查看详细" class="detail"></a>'+_showS7Detail(s)+'<div title="删除" name="s7delete" class="delete"></div></div></td>',E="</tr>";e(v+w+x+y+z+A+B+C+D+E).appendTo(n)}n.appendTo(m),m.appendTo(k),j.appendTo(i),k.appendTo(i),i.appendTo(c),e('<div class="clearfix"></div>').appendTo(i)}_editDeleteControl()},_showS7Detail=function(a){var b=e("#tag_ctx").val(),c='<a href="'+b+"/toUpdateS7UI?s7Id="+a+'" title="修改编辑" class="modify"></a>';return c},_editDeleteControl=function(){e("table tbody tr").each(function(){var a=e(this).text();a.indexOf("未发布")<0&&a.indexOf("未生效")<0&&a.indexOf("已生效")<0&&(e(this).find("[title=修改编辑]").removeAttr("href"),e(this).find("[title=修改编辑]").removeClass("modify"),e(this).find("[title=修改编辑]").addClass("modifyOK")),a.indexOf("未发布")<0&&(e(this).find("[title=删除]").removeClass("delete"),e(this).find("[title=删除]").addClass("deleteOK"))})},d.prototype._getFeeAvailability=function(a){var b="";return"E"===a?b="免费":"X"===a&&(b="不可用"),b},d.prototype._getColor=function(a){var b="";return"1"===a.statusDes?b="red":"2"===a.statusDes?b="orange":"3"===a.statusDes?b="":("4"===a.statusDes||"5"===a.statusDes)&&(b="gray"),b},d.prototype._generateStatus=function(a){var b="";return"1"===a.statusDes?b="未发布":"2"===a.statusDes?b="未生效":"3"===a.statusDes?b="已生效":"4"===a.statusDes?b="已过期":"5"===a.statusDes&&(b="已取消"),b},d.prototype._getMoney=function(a){var b=a.list170VO,c=a.list201VO,d="",e="";if(b.length>0)d=b[0].specFeeAmount,e=b[0].specFeeCurrency;else if(c.length>0){var f=c[0].discountType;"1"==f?(d=c[0].onePriceNum,e="CNY"):(d=c[0].discountNum,e="%")}else d="";return""!==d&&(d+=e),d},d.prototype._getPassengerTypeCode=function(a){var b=" ",c=a.passengerTypeCode;return null!==c&&(b=c),b},d.prototype._getPicture=function(a){var b="1E.jpg",c=j.getCommonImgArr(),d=k.contains(c,a);return d&&(b=a+".jpg"),b},_formatDescription=function(a){var b=170,c=a,d="";if(""===c||"undefined"==typeof c)return d;for(var e=0,f=0;b>f;f++){var g=c.charAt(f);if(/[^x00-xff]/.test(g)&&e++,e>=b)break;d+=g,e++}return d.length<c.length&&(d+="......"),d},_showGeoSpecLocType=function(a){return""!==a?'<b class="gray">('+a+")</b>":""}}),define("fare/oc/1.0.0/common",["jquery"],function(a,b,c){function d(){}var e=a("jquery");c.exports=d,d.prototype.formSerializeObj=function(a){for(var b=e("#"+a).serializeArray(),c={},d=0;d<b.length;d++)c[b[d].name]=b[d].value;return c},d.prototype.baseOptions={type:"POST",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=UTF-8",timeout:1e5,async:!1,error:function(){e.showTuiErrorDialog("系统响应异常！")}},d.prototype.getDate=function(){var a=new Date,b=a.getMonth()<9?"0"+(a.getMonth()+1).toString():(a.getMonth()+1).toString(),c=a.getDate()<10?"0"+a.getDate().toString():a.getDate().toString();return a.getFullYear().toString()+"-"+b+"-"+c}}),define("fare/oc/1.0.0/equipment",["fare/oc/1.0.0/common","jquery"],function(a,b,c){function d(){}var e=a("fare/oc/1.0.0/common"),f=new e;c.exports=d,d.prototype.query=function(a){if("F"===a){var b=$("#s7_F_equipment").attr("url"),c={};f.baseOptions.url=b,f.baseOptions.data=c,f.baseOptions.success=function(a){$("#s7_F_equipment").append("<option/>");for(var b=0;b<a.length;b++){var c="<option>"+a[b].code+"-"+a[b].description+"</option>";$("#s7_F_equipment").append(c)}},$.ajax(f.baseOptions)}if("M"===a){var b=$("#s7_M_equipment").attr("url"),c={};f.baseOptions.url=b,f.baseOptions.data=c,f.baseOptions.success=function(a){$("#s7_M_equipment").append("<option/>");for(var b=0;b<a.length;b++){var c="<option>"+a[b].code+"-"+a[b].description+"</option>";$("#s7_M_equipment").append(c)}},$.ajax(f.baseOptions)}}}),define("fare/oc/1.0.0/util",[],function(a,b,c){var d={};d.getRbdTb198TmpStr=function(){return"rbd"},d.getRbdUpgradeTb198TmpStr=function(){return"rbdUpgrade"},d.getCommonImgArr=function(){var a=["0B5","0DG","0B3","0LO","0LQ","0LT","0BO"];return a},c.exports=d}),define("fare/oc/1.0.0/s7publish",["jquery","fare/oc/1.0.0/common"],function(a,b,c){function d(){}var e=a("jquery"),f=a("fare/oc/1.0.0/common"),g=new f;c.exports=d,d.prototype.init=function(){e("#s7_publish").click(function(){var a=[],b=e("table").find(":checkbox[name=s7check][checked=checked]");if(0===b.length)return e.showTuiErrorDialog("请至少选择一条记录！"),void 0;if(d._validate(a,b)){for(var c={},f=e("#s7_publish").attr("url"),h=0;h<a.length;h++)c["s7IdList["+h+"]"]=a[h];g.baseOptions.url=f,g.baseOptions.data=c,g.baseOptions.success=function(a){"PUBISHSUCCESS"===a?e.showTuiSuccessDialog("发布成功！",function(){e("#s7QueryBtn").trigger("click")}):e.showTuiErrorDialog("系统异常，发布失败！")},e.ajax(g.baseOptions)}})},d._validate=function(a,b){var c=!0;return b.each(function(){var b=e(this).parents("tr").text(),d=e(this).parents("tr").find("[name=firstMaintenanceDate]").text(),f=e(this).parents("tr").find("[name=lastMaintenanceDate]").text(),g=e(this).parents("tr").find(":input[name=s7id]").attr("value"),h=new Date,i=new Date(e.trim(d)),j=new Date(e.trim(f));if(b.indexOf("未发布")>=0){if(!(i>h&&j>=i))return e.showTuiErrorDialog("未发布数据中包含已生效/已过期数据！"),c=!1,!1;a.push(g)}}),c}}),define("fare/oc/1.0.0/s7delete",["jquery","fare/oc/1.0.0/common"],function(a,b,c){function d(){}var e=a("jquery"),f=a("fare/oc/1.0.0/common"),g=new f;c.exports=d,d.prototype.init=function(){e(document).delegate(".delete[name=s7delete]","click",function(){var a=e(this).parents("tr").find(":input[name=s7id]").attr("value"),b=e(this),c={},d=e("#s7_delete").attr("url");c.s7Id=a,g.baseOptions.url=d,g.baseOptions.data=c,g.baseOptions.success=function(a){return null===a?(window.location.reload(),void 0):("SUCCESS"===a?e.showTuiSuccessDialog("删除成功！",function(){1===b.parents("table").find("tr").length&&b.parents("div[name=contentContainer]").remove(),b.parents("tr").remove()}):e.showTuiErrorDialog("系统异常，删除失败！"),void 0)},e.ajax(g.baseOptions)})}});
